<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>AutoTrack - Кузовной ремонт</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            width: 100vw;
            min-height: 100vh;
            overflow-x: hidden;
            background: #f5f5f5;
            color: #333;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        /* Стили для сплеш-скрина */
        #splash {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        #splash img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 20%;
        }

        #splash.hidden {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        /* Основные стили приложения */
        #app {
            width: 100%;
            min-height: 100vh;
            display: none;
            flex-direction: column;
            padding: 16px;
            padding-top: max(16px, env(safe-area-inset-top));
            padding-bottom: max(16px, env(safe-area-inset-bottom));
        }

        #app.visible {
            display: flex;
        }

        .main-content {
            flex: 1;
            padding-bottom: calc(56px + env(safe-area-inset-bottom));
            width: 100%;
        }

        /* Стили для карточек */
        .car-card, .history-card {
            background: #fff;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }

        .history-card {
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .history-card:active {
            transform: scale(0.98);
            box-shadow: 0 1px 6px rgba(0,0,0,0.1);
        }

        /* Стили для каруселей с фотографиями */
        .carousel, .history-carousel {
            position: relative;
            width: 100%;
            height: 220px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 16px;
            background: #f0f0f0;
        }

        .history-carousel {
            height: 200px;
            margin: 12px 0;
        }

        .carousel-inner, .history-carousel-inner {
            display: flex;
            transition: transform 0.3s ease;
            height: 100%;
        }

        .carousel-item, .history-carousel-item {
            min-width: 100%;
            height: 100%;
            flex-shrink: 0;
            position: relative;
        }

        .carousel-item img, .history-carousel-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            animation: fadeIn 0.5s ease-out;
        }

        /* Подписи к фотографиям */
        .history-carousel-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 12px;
            font-size: 13px;
            text-align: center;
        }

        /* Информация об автомобиле */
        .car-model, .history-car-model {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #1a1a1a;
        }

        .car-number, .history-car-number {
            font-size: 14px;
            color: #666;
            background: #f7f7f7;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        .history-date {
            font-size: 14px;
            color: #666;
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(255,255,255,0.9);
            padding: 4px 8px;
            border-radius: 4px;
        }

        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Таймлайн статусов */
        .status-timeline {
            position: relative;
            padding-left: 24px;
            margin-bottom: 24px;
        }

        .timeline-line {
            position: absolute;
            left: 11px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e0e0e0;
            z-index: 1;
        }

        .timeline-fill {
            position: absolute;
            left: 11px;
            top: 0;
            height: 62.5%;
            width: 2px;
            background: #4CAF50;
            z-index: 2;
            transition: height 0.5s ease;
        }

        .timeline-current {
            position: absolute;
            left: 11px;
            top: 62.5%;
            height: 12.5%;
            width: 2px;
            background: #2A5CFF;
            z-index: 3;
        }

        .status-item {
            position: relative;
            padding: 8px 0 8px 32px;
            margin-bottom: 12px;
            z-index: 4;
        }

        .status-item:last-child {
            margin-bottom: 0;
        }

        .status-dot {
            position: absolute;
            left: 0;
            top: 12px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border: 2px solid #e0e0e0;
        }

        .status-item.completed .status-dot {
            background: #4CAF50;
            border-color: #4CAF50;
            color: white;
        }

        .status-item.active .status-dot {
            background: #2A5CFF;
            border-color: #2A5CFF;
            color: white;
        }

        .status-dot-icon {
            font-size: 12px;
            font-weight: bold;
        }

        .status-content {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 12px;
        }

        .status-item.completed .status-content,
        .status-item.active .status-content {
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .status-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
        }

        .status-item.completed .status-title,
        .status-item.active .status-title {
            color: #1a1a1a;
        }

        .status-date {
            font-size: 12px;
            color: #999;
        }

        .status-item.completed .status-date {
            color: #4CAF50;
        }

        .status-item.active .status-date {
            color: #2A5CFF;
        }

        .status-description {
            font-size: 13px;
            color: #666;
            line-height: 1.4;
        }

        .status-item.active .status-description {
            color: #333;
        }

        .status-estimate-btn {
            position: absolute;
            right: 12px;
            bottom: 12px;
            background: #2A5CFF;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
        }

        /* Карточка текущего статуса */
        .current-status-card {
            background: #2A5CFF;
            border-radius: 12px;
            padding: 16px;
            color: white;
            margin-top: 16px;
            box-shadow: 0 4px 12px rgba(42, 92, 255, 0.2);
        }

        .current-status-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .current-status-icon {
            margin-right: 8px;
            width: 20px;
            height: 20px;
        }

        .current-status-text {
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .current-status-time {
            font-size: 13px;
            opacity: 0.9;
            display: flex;
            align-items: center;
        }

        .time-icon {
            margin-right: 6px;
            width: 14px;
            height: 14px;
        }

        /* Кнопки */
        .buttons-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .btn {
            height: 56px;
            border-radius: 16px;
            border: none;
            font-size: 17px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.1s ease, opacity 0.2s ease;
            width: 100%;
        }

        .btn:active {
            transform: scale(0.96);
            opacity: 0.9;
        }

        .btn-call {
            background: #2A5CFF;
            color: white;
        }

        .btn-chat {
            background: #EFEFEF;
            color: #1a1a1a;
        }

        .btn-estimate {
            background: #2A5CFF;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
        }

        .btn-icon {
            margin-right: 8px;
            width: 20px;
            height: 20px;
        }

        /* История посещений */
        #history-view {
            width: 100%;
            padding-bottom: 20px;
            display: none;
        }

        .history-header {
            padding: 16px;
            margin-bottom: 16px;
        }

        .history-header h2 {
            font-size: 24px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .history-items {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 0 16px;
        }

        .history-work-list {
            margin-bottom: 16px;
        }

        .history-work-list h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1a1a1a;
        }

        .history-work-list ul {
            padding-left: 20px;
        }

        .history-work-list li {
            font-size: 14px;
            color: #333;
            margin-bottom: 4px;
        }

        /* Детали посещения */
        #visit-detail-view {
            display: none;
            width: 100%;
            padding-bottom: 20px;
        }

        .visit-detail-card {
            background: #fff;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        .visit-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .visit-detail-title {
            font-size: 20px;
            font-weight: 600;
        }

        .visit-detail-back {
            font-size: 14px;
            color: #2A5CFF;
            cursor: pointer;
        }

        /* Таббар */
        .tabbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: calc(56px + env(safe-area-inset-bottom));
            background: #fff;
            display: flex;
            border-top: 1px solid #e0e0e0;
            z-index: 100;
        }

        .tabbar-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 12px;
            text-decoration: none;
        }

        .tabbar-item.active {
            color: #2A5CFF;
        }

        .tabbar-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
        }

        /* Стили для профиля */
        #profile-view {
            display: none;
            width: 100%;
            padding-bottom: 20px;
        }

        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 24px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #2A5CFF;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .profile-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .profile-phone {
            font-size: 16px;
            color: #666;
        }

        .profile-section {
            margin-bottom: 24px;
        }

        .profile-section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            padding-left: 8px;
        }

        .profile-info-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
        }

        .profile-info-label {
            color: #666;
        }

        .profile-info-value {
            font-weight: 500;
        }

        .profile-button {
            width: 100%;
            padding: 14px;
            background: #2A5CFF;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            transition: opacity 0.2s;
        }

        .profile-button:active {
            opacity: 0.8;
        }

        .profile-button.secondary {
            background: #EFEFEF;
            color: #1a1a1a;
        }

        /* Адаптация для планшетов и десктопов */
        @media (min-width: 768px) {
            .carousel {
                height: 280px;
            }
            .history-carousel {
                height: 240px;
            }
        }

        /* Поддержка iOS */
        @supports (-webkit-touch-callout: none) {
            body {
                min-height: 100vh;
                min-height: -webkit-fill-available;
            }
            #app {
                min-height: -webkit-fill-available;
            }
        }

        /* Стили для профиля */
        #profile-view {
            display: none;
            width: 100%;
            padding-bottom: 20px;
        }

        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 24px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #2A5CFF;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .profile-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .profile-phone {
            font-size: 16px;
            color: #666;
        }

        .profile-section {
            margin-bottom: 24px;
        }

        .profile-section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            padding-left: 8px;
        }

        .profile-info-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
        }

        .profile-info-label {
            color: #666;
        }

        .profile-info-value {
            font-weight: 500;
        }

        .profile-button {
            width: 100%;
            padding: 14px;
            background: #2A5CFF;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            transition: opacity 0.2s;
        }

        .profile-button:active {
            opacity: 0.8;
        }

        .profile-button.secondary {
            background: #EFEFEF;
            color: #1a1a1a;
        }

        /* Адаптация для планшетов и десктопов */
        @media (min-width: 768px) {
            .carousel {
                height: 280px;
            }
            .history-carousel {
                height: 240px;
            }
        }

        /* Поддержка iOS */
        @supports (-webkit-touch-callout: none) {
            body {
                min-height: 100vh;
                min-height: -webkit-fill-available;
            }
            #app {
                min-height: -webkit-fill-available;
            }
        }

    </style>
</head>
<body>
<div id="splash">
    <img src="Screen.png" alt="AutoTrack Logo">
</div>

<div id="app">
    <div class="main-content">
        <div class="car-card">
            <div class="carousel" id="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item">
                        <img src="splash1.jpg" alt="BMW X5 - вид спереди" loading="lazy">
                    </div>
                    <div class="carousel-item">
                        <img src="splash2.jpg" alt="BMW X5 - вид сбоку" loading="lazy">
                    </div>
                </div>
            </div>

            <div class="car-info">
                <div class="car-model">BMW X5 (G05)</div>
                <div class="car-number">А123БВ777</div>
            </div>

            <div class="progress-container">
                <div class="status-timeline">
                    <div class="timeline-line"></div>
                    <div class="timeline-fill"></div>
                    <div class="timeline-current"></div>

                    <div class="status-item completed">
                        <div class="status-dot">
                            <span class="status-dot-icon">✓</span>
                        </div>
                        <div class="status-content">
                            <div class="status-title">
                                <span>Дефектовка</span>
                                <span class="status-date">12.04.2023</span>
                            </div>
                            <div class="status-description">Выявлены все повреждения, составлен отчёт</div>
                        </div>
                    </div>

                    <div class="status-item completed">
                        <div class="status-dot">
                            <span class="status-dot-icon">✓</span>
                        </div>
                        <div class="status-content">
                            <div class="status-title">
                                <span>Формирование сметы</span>
                                <span class="status-date">14.04.2023</span>
                            </div>
                            <div class="status-description">Смета утверждена, ожидается согласование</div>
                        </div>
                    </div>

                    <div class="status-item completed">
                        <div class="status-dot">
                            <span class="status-dot-icon">✓</span>
                        </div>
                        <div class="status-content">
                            <div class="status-title">
                                <span>Согласование</span>
                                <span class="status-date">15.04.2023</span>
                            </div>
                            <div class="status-description">Смета согласована, работы подтверждены</div>
                            <button class="status-estimate-btn" onclick="showEstimate()">Смета</button>
                        </div>
                    </div>

                    <div class="status-item completed">
                        <div class="status-dot">
                            <span class="status-dot-icon">✓</span>
                        </div>
                        <div class="status-content">
                            <div class="status-title">
                                <span>Разборка</span>
                                <span class="status-date">17.04.2023</span>
                            </div>
                            <div class="status-description">Автомобиль разобран, повреждённые детали сняты</div>
                        </div>
                    </div>

                    <div class="status-item completed">
                        <div class="status-dot">
                            <span class="status-dot-icon">✓</span>
                        </div>
                        <div class="status-content">
                            <div class="status-title">
                                <span>Рихтовка</span>
                                <span class="status-date">19.04.2023</span>
                            </div>
                            <div class="status-description">Кузовные панели выровнены, подготовлены к покраске</div>
                        </div>
                    </div>

                    <div class="status-item active">
                        <div class="status-dot">
                            <span class="status-dot-icon">!</span>
                        </div>
                        <div class="status-content">
                            <div class="status-title">
                                <span>Покраска</span>
                                <span class="status-date">В процессе</span>
                            </div>
                            <div class="status-description">Начата покраска кузовных элементов</div>
                        </div>
                    </div>

                    <div class="status-item">
                        <div class="status-dot"></div>
                        <div class="status-content">
                            <div class="status-title">Сборка</div>
                            <div class="status-description">Ожидается после завершения покраски</div>
                        </div>
                    </div>

                    <div class="status-item">
                        <div class="status-dot"></div>
                        <div class="status-content">
                            <div class="status-title">Готов к выдаче</div>
                            <div class="status-description">Автомобиль пройдёт финальный осмотр</div>
                        </div>
                    </div>
                </div>

                <div class="current-status-card">
                    <div class="current-status-title">
                        <svg class="current-status-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20ZM12.5 7H11V13L16.2 16.2L17 14.9L12.5 12.2V7Z" fill="currentColor"/>
                        </svg>
                        Текущий статус
                    </div>
                    <div class="current-status-text">
                        Ваш автомобиль находится в покрасочной камере. Идёт процесс нанесения
                        базового покрытия и лака.
                    </div>
                    <div class="current-status-time">
                        <svg class="time-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M11.99 2C6.47 2 2 6.48 2 12C2 17.52 6.47 22 11.99 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 11.99 2ZM12 20C7.58 20 4 16.42 4 12C4 7.58 7.58 4 12 4C16.42 4 20 7.58 20 12C20 16.42 16.42 20 12 20ZM12.5 7H11V13L16.25 16.15L17 14.92L12.5 12.25V7Z" fill="currentColor"/>
                        </svg>
                        Ориентировочное завершение: 25.04.2023
                    </div>
                </div>
            </div>
        </div>

        <div class="buttons-container">
            <button class="btn btn-call" id="callBtn">
                <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20.487 17.14L16.422 13.645C16.2301 13.482 15.9776 13.416 15.7311 13.464C15.4845 13.512 15.2714 13.669 15.148 13.892L13.669 16.557C11.2645 15.438 8.85995 13.033 7.74295 10.628L10.407 9.15095C10.6304 9.0275 10.7876 8.8143 10.8356 8.5676C10.8836 8.3209 10.8177 8.0682 10.654 7.87695L7.15995 3.81295C6.98738 3.61199 6.74052 3.497 6.48145 3.497C6.22238 3.497 5.97552 3.61199 5.80295 3.81295L3.53095 6.37295C3.34385 6.587 3.24582 6.862 3.25695 7.143C3.53795 12.603 11.396 20.461 16.857 20.742C17.138 20.753 17.413 20.655 17.627 20.468L20.187 18.196C20.3873 18.0235 20.5023 17.7766 20.5023 17.5176C20.5023 17.2585 20.3873 17.0116 20.187 16.839L20.487 17.14Z" fill="currentColor"/>
                </svg>
                Позвонить в сервис
            </button>
            <button class="btn btn-chat" id="chatBtn">
                <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2ZM20 16H6L4 18V4H20V16Z" fill="currentColor"/>
                </svg>
                Написать мастеру
            </button>
        </div>
    </div>

    <!-- История посещений -->
    <div id="history-view">
        <div class="history-header">
            <h2>История посещений</h2>
        </div>
        <div class="history-items">
            <div class="history-card" onclick="showVisitDetail(1)">
                <div class="history-date">15.04.2023 - 25.04.2023</div>
                <div class="history-car-info">
                    <div class="history-car-model">BMW X5 (G05)</div>
                    <div class="history-car-number">А123БВ777</div>
                </div>
                <div class="history-carousel">
                    <div class="history-carousel-inner">
                        <div class="history-carousel-item">
                            <img src="splash1.jpg" alt="До ремонта" loading="lazy">
                            <div class="history-carousel-caption">До ремонта</div>
                        </div>
                        <div class="history-carousel-item">
                            <img src="splash2.jpg" alt="После ремонта" loading="lazy">
                            <div class="history-carousel-caption">После ремонта</div>
                        </div>
                    </div>
                </div>
                <div class="history-work-list">
                    <h3>Выполненные работы:</h3>
                    <ul>
                        <li>Ремонт правого переднего крыла</li>
                        <li>Замена правой передней фары</li>
                        <li>Покраска правых дверей</li>
                        <li>Ремонт порога</li>
                    </ul>
                </div>
            </div>

            <div class="history-card" onclick="showVisitDetail(2)">
                <div class="history-date">10.02.2023 - 20.02.2023</div>
                <div class="history-car-info">
                    <div class="history-car-model">Audi Q7</div>
                    <div class="history-car-number">В456СЕ777</div>
                </div>
                <div class="history-carousel">
                    <div class="history-carousel-inner">
                        <div class="history-carousel-item">
                            <img src="audi_damage.webp" alt="До ремонта" loading="lazy">
                            <div class="history-carousel-caption">До ремонта</div>
                        </div>
                        <div class="history-carousel-item">
                            <img src="audi_repaired.webp" alt="После ремонта" loading="lazy">
                            <div class="history-carousel-caption">После ремонта</div>
                        </div>
                    </div>
                </div>
                <div class="history-work-list">
                    <h3>Выполненные работы:</h3>
                    <ul>
                        <li>Ремонт заднего бампера</li>
                        <li>Покраска задней двери</li>
                        <li>Замена стекла задней двери</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Детали посещения -->
    <div id="visit-detail-view">
        <div class="visit-detail-card">
            <div class="visit-detail-header">
                <div class="visit-detail-title">Детали посещения</div>
            </div>
            <div id="visit-detail-content">
                <!-- Контент будет заполняться динамически -->
            </div>
        </div>
    </div>

    <!-- Профиль пользователя -->
    <div id="profile-view">
        <div class="profile-card">
            <div class="profile-header">
                <div class="profile-avatar">ИИ</div>
                <div class="profile-name">Иван Иванов</div>
                <div class="profile-phone">+7 (999) 123-45-67</div>
            </div>

            <div class="profile-section">
                <div class="profile-section-title">Личная информация</div>
                <div class="profile-info-item">
                    <span class="profile-info-label">Email</span>
                    <span class="profile-info-value">ivanov@example.com</span>
                </div>
                <div class="profile-info-item">
                    <span class="profile-info-label">Дата регистрации</span>
                    <span class="profile-info-value">15.03.2023</span>
                </div>
                <div class="profile-info-item">
                    <span class="profile-info-label">Автомобилей в ремонте</span>
                    <span class="profile-info-value">1</span>
                </div>
                <div class="profile-info-item">
                    <span class="profile-info-label">Завершенных ремонтов</span>
                    <span class="profile-info-value">2</span>
                </div>
            </div>

            <div class="profile-section">
                <div class="profile-section-title">Настройки</div>
                <button class="profile-button secondary" onclick="tg.showAlert('Уведомления включены')">
                    Настройки уведомлений
                </button>
                <button class="profile-button secondary" onclick="tg.showAlert('Язык изменен')">
                    Сменить язык
                </button>
            </div>

            <div class="profile-section">
                <button class="profile-button" onclick="tg.showAlert('Обращение в поддержку отправлено')">
                    Связаться с поддержкой
                </button>
                <button class="profile-button secondary" onclick="tg.showConfirm('Вы уверены, что хотите выйти?', function(ok) { if(ok) tg.close() })">
                    Выйти из аккаунта
                </button>
            </div>
        </div>
    </div>

    <!-- Таббар -->
    <div class="tabbar">
        <a href="#" class="tabbar-item active" id="main-tab">
            <svg class="tabbar-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 20V14H14V20H19V12H22L12 3L2 12H5V20H10Z" fill="currentColor"/>
            </svg>
            Главная
        </a>
        <a href="#" class="tabbar-item" id="history-tab">
            <svg class="tabbar-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 3H18V1H16V3H8V1H6V3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V8H19V19Z" fill="currentColor"/>
            </svg>
            История
        </a>
        <a href="#" class="tabbar-item" id="profile-tab">
            <svg class="tabbar-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z" fill="currentColor"/>
            </svg>
            Профиль
        </a>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    let currentView = 'main', currentSlide = 0, startX = 0, isDragging = false;

    // Данные о посещениях
    const visits = {
        1: {
            model: "BMW X5 (G05)",
            number: "А123БВ777",
            date: "15.04.2023 - 25.04.2023",
            beforeImg: "images/bmw_damage.webp",
            afterImg: "images/bmw_repaired.webp",
            works: [
                "Ремонт правого переднего крыла - 25 000 руб.",
                "Замена правой передней фары - 18 500 руб.",
                "Покраска правых дверей - 32 000 руб.",
                "Ремонт порога - 15 000 руб."
            ],
            total: "90 500 руб."
        },
        2: {
            model: "Audi Q7",
            number: "В456СЕ777",
            date: "10.02.2023 - 20.02.2023",
            beforeImg: "images/audi_damage.webp",
            afterImg: "images/audi_repaired.webp",
            works: [
                "Ремонт заднего бампера - 18 000 руб.",
                "Покраска задней двери - 22 000 руб.",
                "Замена стекла задней двери - 35 000 руб."
            ],
            total: "75 000 руб."
        }
    };

    function showMainView() {
        currentView = 'main';
        document.querySelector('.main-content').style.display = 'block';
        document.getElementById('history-view').style.display = 'none';
        document.getElementById('profile-view').style.display = 'none';
        document.getElementById('visit-detail-view').style.display = 'none';
        document.getElementById('main-tab').classList.add('active');
        document.getElementById('history-tab').classList.remove('active');
        document.getElementById('profile-tab').classList.remove('active');
        tg.BackButton.hide();
    }

    function showHistoryView() {
        currentView = 'history';
        document.querySelector('.main-content').style.display = 'none';
        document.getElementById('history-view').style.display = 'block';
        document.getElementById('profile-view').style.display = 'none';
        document.getElementById('visit-detail-view').style.display = 'none';
        document.getElementById('main-tab').classList.remove('active');
        document.getElementById('history-tab').classList.add('active');
        document.getElementById('profile-tab').classList.remove('active');
        tg.BackButton.show();
        tg.BackButton.onClick(showMainView);
    }

    function showProfileView() {
        currentView = 'profile';
        document.querySelector('.main-content').style.display = 'none';
        document.getElementById('history-view').style.display = 'none';
        document.getElementById('profile-view').style.display = 'block';
        document.getElementById('visit-detail-view').style.display = 'none';
        document.getElementById('main-tab').classList.remove('active');
        document.getElementById('history-tab').classList.remove('active');
        document.getElementById('profile-tab').classList.add('active');
        tg.BackButton.show();
        tg.BackButton.onClick(showMainView);
    }

    function showVisitDetail(visitId) {
        currentView = 'visit-detail';
        const visit = visits[visitId];

        let worksHtml = '';
        visit.works.forEach(work => {
            worksHtml += `<li>${work}</li>`;
        });

        const detailContent = `
                <div class="history-car-info">
                    <div class="history-car-model">${visit.model}</div>
                    <div class="history-car-number">${visit.number}</div>
                    <div class="history-date">${visit.date}</div>
                </div>

                <div class="history-carousel">
                    <div class="history-carousel-inner">
                        <div class="history-carousel-item">
                            <img src="${visit.beforeImg}" alt="До ремонта" loading="lazy">
                            <div class="history-carousel-caption">До ремонта</div>
                        </div>
                        <div class="history-carousel-item">
                            <img src="${visit.afterImg}" alt="После ремонта" loading="lazy">
                            <div class="history-carousel-caption">После ремонта</div>
                        </div>
                    </div>
                </div>

                <div class="history-work-list">
                    <h3>Выполненные работы:</h3>
                    <ul>${worksHtml}</ul>
                </div>

                <div class="current-status-card" style="margin-top: 20px;">
                    <div class="current-status-title">Итоговая смета</div>
                    <div class="current-status-text">Общая сумма: ${visit.total}</div>
                    <button class="btn btn-estimate" onclick="tg.showAlert('Смета по ${visit.model}\\n\\n${visit.works.join('\\n')}\\n\\nИтого: ${visit.total}')">
                        Показать полную смету
                    </button>
                </div>
            `;

        document.getElementById('visit-detail-content').innerHTML = detailContent;
        document.querySelector('.main-content').style.display = 'none';
        document.getElementById('history-view').style.display = 'none';
        document.getElementById('profile-view').style.display = 'none';
        document.getElementById('visit-detail-view').style.display = 'block';

        tg.BackButton.show();
        tg.BackButton.onClick(backToHistory);
    }

    function backToHistory() {
        showHistoryView();
    }

    function showEstimate() {
        tg.showAlert('Смета согласована 15.04.2023. Общая сумма: 125 430 руб.');
    }

    function updateCarousel() {
        document.querySelector('.carousel-inner').style.transform = `translateX(-${currentSlide * 100}%)`;
    }

    function nextSlide() {
        const slides = document.querySelectorAll('.carousel-item');
        currentSlide = (currentSlide + 1) % slides.length;
        updateCarousel();
    }

    function prevSlide() {
        const slides = document.querySelectorAll('.carousel-item');
        currentSlide = (currentSlide - 1 + slides.length) % slides.length;
        updateCarousel();
    }

    function handleTouchStart(e) {
        startX = e.touches[0].clientX;
        isDragging = true;
    }

    function handleTouchMove(e) {
        if (!isDragging) return;
        e.preventDefault();
        const diff = startX - e.touches[0].clientX;
        if (Math.abs(diff) > 50) {
            isDragging = false;
            diff > 0 ? nextSlide() : prevSlide();
        }
    }

    function handleTouchEnd() {
        isDragging = false;
    }

    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
            document.getElementById('splash').classList.add('hidden');
            document.getElementById('app').classList.add('visible');
            showMainView();
            updateCarousel();
        }, 1500);

        document.getElementById('callBtn')?.addEventListener('click', () => tg.openTelegramLink('tel:+79991234567'));
        document.getElementById('chatBtn')?.addEventListener('click', () => tg.openTelegramLink('https://t.me/AutoService_Support'));
        document.getElementById('history-tab').addEventListener('click', showHistoryView);
        document.getElementById('main-tab').addEventListener('click', showMainView);
        document.getElementById('profile-tab').addEventListener('click', showProfileView);

        const carousel = document.getElementById('carousel');
        carousel.addEventListener('touchstart', handleTouchStart, { passive: false });
        carousel.addEventListener('touchmove', handleTouchMove, { passive: false });
        carousel.addEventListener('touchend', handleTouchEnd);

        if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            document.body.style.minHeight = '100vh';
            document.body.style.minHeight = '-webkit-fill-available';
            document.getElementById('app').style.minHeight = '-webkit-fill-available';
        }

        tg.ready();
        tg.expand();
        tg.enableClosingConfirmation();
        tg.BackButton.hide();
    });
</script>
</body>
</html>
