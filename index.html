<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>AutoTrack - Кузовной ремонт</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            width: 100vw;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            touch-action: pan-y;
            background: #f5f5f5;
            color: #333;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        #splash {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #FFFFFF;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        #splash img {
            width: 100%;
            height: 100%;
        }

        #splash.hidden {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        #app {
            width: 100%;
            min-height: 100vh;
            display: none;
            flex-direction: column;
            padding: 16px;
            padding-top: max(16px, env(safe-area-inset-top));
            padding-bottom: max(16px, env(safe-area-inset-bottom));
            overflow-y: auto;
        }

        #app.visible {
            display: flex;
        }

        .car-card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .carousel {
            position: relative;
            width: 100%;
            height: 180px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 12px;
            touch-action: pan-y;
        }

        .carousel-inner {
            display: flex;
            transition: transform 0.3s ease;
            height: 100%;
        }

        .carousel-item {
            min-width: 100%;
            height: 100%;
            flex-shrink: 0;
        }

        .carousel-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .carousel-controls {
            position: absolute;
            bottom: 10px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 6px;
            z-index: 10;
        }

        .carousel-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            transition: background 0.3s ease;
        }

        .carousel-dot.active {
            background: white;
        }

        .car-info {
            margin-bottom: 16px;
        }

        .car-model {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #1a1a1a;
        }

        .car-number {
            font-size: 14px;
            color: #666;
            background: #f7f7f7;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        .progress-container {
            margin: 20px 0;
            width: 100%;
        }

        .status-timeline {
            position: relative;
            padding-left: 24px;
            margin-bottom: 24px;
        }

        .timeline-line {
            position: absolute;
            left: 11px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e0e0e0;
            z-index: 1;
        }

        .timeline-fill {
            position: absolute;
            left: 11px;
            top: 0;
            height: 62.5%;
            width: 2px;
            background: #4CAF50;
            z-index: 2;
            transition: height 0.5s ease;
        }

        .timeline-current {
            position: absolute;
            left: 11px;
            top: 62.5%;
            height: 12.5%;
            width: 2px;
            background: #2A5CFF;
            z-index: 3;
        }

        .status-item {
            position: relative;
            padding: 8px 0 8px 32px;
            margin-bottom: 12px;
            z-index: 4;
        }

        .status-item:last-child {
            margin-bottom: 0;
        }

        .status-dot {
            position: absolute;
            left: 0;
            top: 12px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border: 2px solid #e0e0e0;
        }

        .status-item.completed .status-dot {
            background: #4CAF50;
            border-color: #4CAF50;
            color: white;
        }

        .status-item.active .status-dot {
            background: #2A5CFF;
            border-color: #2A5CFF;
            color: white;
        }

        .status-dot-icon {
            font-size: 12px;
            font-weight: bold;
        }

        .status-content {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 12px;
            position: relative;
        }

        .status-item.completed .status-content,
        .status-item.active .status-content {
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .status-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
        }

        .status-item.completed .status-title,
        .status-item.active .status-title {
            color: #1a1a1a;
        }

        .status-date {
            font-size: 12px;
            color: #999;
            font-weight: normal;
        }

        .status-item.completed .status-date {
            color: #4CAF50;
        }

        .status-item.active .status-date {
            color: #2A5CFF;
        }

        .status-description {
            font-size: 13px;
            color: #666;
            line-height: 1.4;
        }

        .status-item.active .status-description {
            color: #333;
        }

        .status-estimate-btn {
            position: absolute;
            right: 12px;
            bottom: 12px;
            background: #2A5CFF;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .current-status-card {
            background: #2A5CFF;
            border-radius: 12px;
            padding: 16px;
            color: white;
            margin-top: 16px;
            box-shadow: 0 4px 12px rgba(42, 92, 255, 0.2);
        }

        .current-status-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .current-status-icon {
            margin-right: 8px;
            width: 20px;
            height: 20px;
        }

        .current-status-text {
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .current-status-time {
            font-size: 13px;
            opacity: 0.9;
            display: flex;
            align-items: center;
        }

        .time-icon {
            margin-right: 6px;
            width: 14px;
            height: 14px;
        }

        .buttons-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .btn {
            height: 56px;
            border-radius: 16px;
            border: none;
            font-size: 17px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.1s ease, opacity 0.2s ease;
            width: 100%;
        }

        .btn:active {
            transform: scale(0.96);
            opacity: 0.9;
        }

        .btn-call {
            background: #2A5CFF;
            color: white;
        }

        .btn-chat {
            background: #EFEFEF;
            color: #1a1a1a;
        }

        .btn-icon {
            margin-right: 8px;
            width: 20px;
            height: 20px;
        }

        @supports (-webkit-touch-callout: none) {
            body {
                min-height: '100vh';
                min-height: '-webkit-fill-available';
            }
            #app {
                min-height: '-webkit-fill-available';
            }
        }
    </style>
</head>
<body>
<div id="splash">
    <img src="Screen.png" alt="AutoTrack Logo">
</div>

<div id="app">
    <div class="car-card">
        <div class="carousel" id="carousel">
            <div class="carousel-inner">
                <div class="carousel-item">
                    <img src="BMW.jpg" alt="BMW X5 - вид спереди">
                </div>
                <div class="carousel-item">
                    <img src="BMW2.jpg" alt="BMW X5 - вид сбоку">
                </div>
            </div>
            <div class="carousel-controls">
                <div class="carousel-dot active"></div>
                <div class="carousel-dot"></div>
            </div>
        </div>

        <div class="car-info">
            <div class="car-model">BMW X5 (G05)</div>
            <div class="car-number">А123БВ777</div>
        </div>

        <div class="progress-container">
            <div class="status-timeline">
                <div class="timeline-line"></div>
                <div class="timeline-fill"></div>
                <div class="timeline-current"></div>

                <div class="status-item completed">
                    <div class="status-dot">
                        <span class="status-dot-icon">✓</span>
                    </div>
                    <div class="status-content">
                        <div class="status-title">
                            <span>Дефектовка</span>
                            <span class="status-date">12.04.2023</span>
                        </div>
                        <div class="status-description">Выявлены все повреждения, составлен отчёт</div>
                    </div>
                </div>

                <div class="status-item completed">
                    <div class="status-dot">
                        <span class="status-dot-icon">✓</span>
                    </div>
                    <div class="status-content">
                        <div class="status-title">
                            <span>Формирование сметы</span>
                            <span class="status-date">14.04.2023</span>
                        </div>
                        <div class="status-description">Смета утверждена, ожидается согласование</div>
                    </div>
                </div>

                <div class="status-item completed">
                    <div class="status-dot">
                        <span class="status-dot-icon">✓</span>
                    </div>
                    <div class="status-content">
                        <div class="status-title">
                            <span>Согласование</span>
                            <span class="status-date">15.04.2023</span>
                        </div>
                        <div class="status-description">Смета согласована, работы подтверждены</div>
                        <button class="status-estimate-btn" onclick="showEstimate()">Смета</button>
                    </div>
                </div>

                <div class="status-item completed">
                    <div class="status-dot">
                        <span class="status-dot-icon">✓</span>
                    </div>
                    <div class="status-content">
                        <div class="status-title">
                            <span>Разборка</span>
                            <span class="status-date">17.04.2023</span>
                        </div>
                        <div class="status-description">Автомобиль разобран, повреждённые детали сняты</div>
                    </div>
                </div>

                <div class="status-item completed">
                    <div class="status-dot">
                        <span class="status-dot-icon">✓</span>
                    </div>
                    <div class="status-content">
                        <div class="status-title">
                            <span>Рихтовка</span>
                            <span class="status-date">19.04.2023</span>
                        </div>
                        <div class="status-description">Кузовные панели выровнены, подготовлены к покраске</div>
                    </div>
                </div>

                <div class="status-item active">
                    <div class="status-dot">
                        <span class="status-dot-icon">!</span>
                    </div>
                    <div class="status-content">
                        <div class="status-title">
                            <span>Покраска</span>
                            <span class="status-date">В процессе</span>
                        </div>
                        <div class="status-description">Начата покраска кузовных элементов</div>
                    </div>
                </div>

                <div class="status-item">
                    <div class="status-dot"></div>
                    <div class="status-content">
                        <div class="status-title">Сборка</div>
                        <div class="status-description">Ожидается после завершения покраски</div>
                    </div>
                </div>

                <div class="status-item">
                    <div class="status-dot"></div>
                    <div class="status-content">
                        <div class="status-title">Готов к выдаче</div>
                        <div class="status-description">Автомобиль пройдёт финальный осмотр</div>
                    </div>
                </div>
            </div>

            <div class="current-status-card">
                <div class="current-status-title">
                    <svg class="current-status-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20ZM12.5 7H11V13L16.2 16.2L17 14.9L12.5 12.2V7Z" fill="currentColor"/>
                    </svg>
                    Текущий статус
                </div>
                <div class="current-status-text">
                    Ваш автомобиль находится в покрасочной камере. Идёт процесс нанесения
                    базового покрытия и лака.
                </div>
                <div class="current-status-time">
                    <svg class="time-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11.99 2C6.47 2 2 6.48 2 12C2 17.52 6.47 22 11.99 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 11.99 2ZM12 20C7.58 20 4 16.42 4 12C4 7.58 7.58 4 12 4C16.42 4 20 7.58 20 12C20 16.42 16.42 20 12 20ZM12.5 7H11V13L16.25 16.15L17 14.92L12.5 12.25V7Z" fill="currentColor"/>
                    </svg>
                    Ориентировочное завершение: 25.04.2023
                </div>
            </div>
        </div>
    </div>

    <div class="buttons-container">
        <button class="btn btn-call" id="callBtn">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20.487 17.14L16.422 13.645C16.2301 13.482 15.9776 13.416 15.7311 13.464C15.4845 13.512 15.2714 13.669 15.148 13.892L13.669 16.557C11.2645 15.438 8.85995 13.033 7.74295 10.628L10.407 9.15095C10.6304 9.0275 10.7876 8.8143 10.8356 8.5676C10.8836 8.3209 10.8177 8.0682 10.654 7.87695L7.15995 3.81295C6.98738 3.61199 6.74052 3.497 6.48145 3.497C6.22238 3.497 5.97552 3.61199 5.80295 3.81295L3.53095 6.37295C3.34385 6.587 3.24582 6.862 3.25695 7.143C3.53795 12.603 11.396 20.461 16.857 20.742C17.138 20.753 17.413 20.655 17.627 20.468L20.187 18.196C20.3873 18.0235 20.5023 17.7766 20.5023 17.5176C20.5023 17.2585 20.3873 17.0116 20.187 16.839L20.487 17.14Z" fill="currentColor"/>
            </svg>
            Позвонить в сервис
        </button>
        <button class="btn btn-chat" id="chatBtn">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2ZM20 16H6L4 18V4H20V16Z" fill="currentColor"/>
            </svg>
            Написать мастеру
        </button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    let currentView = 'main';
    let currentSlide = 0;
    let startX = 0;
    let isDragging = false;
    let carouselInterval;

    function showMainView() {
        currentView = 'main';
        document.getElementById('app').style.display = 'flex';
        tg.BackButton.hide();
    }

    function showEstimate() {
        tg.showAlert('Смета согласована 15.04.2023. Общая сумма: 125 430 руб.');
    }

    function updateCarousel() {
        const carouselInner = document.querySelector('.carousel-inner');
        const dots = document.querySelectorAll('.carousel-dot');
        const slides = document.querySelectorAll('.carousel-item');

        carouselInner.style.transform = `translateX(-${currentSlide * 100}%)`;

        dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === currentSlide);
        });
    }

    function nextSlide() {
        const slides = document.querySelectorAll('.carousel-item');
        currentSlide = (currentSlide + 1) % slides.length;
        updateCarousel();
    }

    function prevSlide() {
        const slides = document.querySelectorAll('.carousel-item');
        currentSlide = (currentSlide - 1 + slides.length) % slides.length;
        updateCarousel();
    }

    function goToSlide(index) {
        currentSlide = index;
        updateCarousel();
    }

    function handleTouchStart(e) {
        startX = e.touches[0].clientX;
        isDragging = true;
        clearInterval(carouselInterval);
    }

    function handleTouchMove(e) {
        if (!isDragging) return;
        e.preventDefault();
        const x = e.touches[0].clientX;
        const diff = startX - x;

        if (Math.abs(diff) > 50) {
            isDragging = false;
            if (diff > 0) {
                nextSlide();
            } else {
                prevSlide();
            }
        }
    }

    function handleTouchEnd() {
        isDragging = false;
        startAutoScroll();
    }

    function handleMouseDown(e) {
        startX = e.clientX;
        isDragging = true;
        clearInterval(carouselInterval);
    }

    function handleMouseMove(e) {
        if (!isDragging) return;
        const x = e.clientX;
        const diff = startX - x;

        if (Math.abs(diff) > 50) {
            isDragging = false;
            if (diff > 0) {
                nextSlide();
            } else {
                prevSlide();
            }
        }
    }

    function handleMouseUp() {
        isDragging = false;
        startAutoScroll();
    }

    function startAutoScroll() {
        clearInterval(carouselInterval);
        carouselInterval = setInterval(nextSlide, 5000);
    }

    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
            document.getElementById('splash').classList.add('hidden');
            document.getElementById('app').classList.add('visible');
            showMainView();

            // Инициализация карусели
            updateCarousel();
            startAutoScroll();
        }, 1500);

        // Назначение обработчиков
        document.getElementById('callBtn')?.addEventListener('click', () => {
            tg.openTelegramLink('tel:+79991234567');
        });

        document.getElementById('chatBtn')?.addEventListener('click', () => {
            tg.openTelegramLink('https://t.me/AutoService_Support');
        });

        // Обработчики для карусели
        const carousel = document.getElementById('carousel');

        // Touch events
        carousel.addEventListener('touchstart', handleTouchStart, { passive: false });
        carousel.addEventListener('touchmove', handleTouchMove, { passive: false });
        carousel.addEventListener('touchend', handleTouchEnd);

        // Mouse events for testing on desktop
        carousel.addEventListener('mousedown', handleMouseDown);
        carousel.addEventListener('mousemove', handleMouseMove);
        carousel.addEventListener('mouseup', handleMouseUp);
        carousel.addEventListener('mouseleave', handleMouseUp);

        // Обработчики для точек
        const dots = document.querySelectorAll('.carousel-dot');
        dots.forEach((dot, index) => {
            dot.addEventListener('click', () => goToSlide(index));
        });

        // Инициализация WebApp
        tg.ready();
        tg.expand();
        tg.enableClosingConfirmation();
        tg.BackButton.hide();

        // Оптимизация для iOS
        if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            document.body.style.minHeight = '100vh';
            document.body.style.minHeight = '-webkit-fill-available';
            document.getElementById('app').style.minHeight = '-webkit-fill-available';
        }
    });
</script>
</body>
</html>
