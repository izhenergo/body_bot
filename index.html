<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>СТО Сервис</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<!-- Сплеш-скрин -->
<div id="splash">
    <img src="images/Splash.jpg" alt="Splash Screen">
</div>

<!-- Просмотр фотографий -->
<div id="photoViewer" class="photo-viewer">
    <div class="photo-viewer-content" id="photoViewerContent">
        <button class="close-viewer" id="closeViewer">×</button>
        <div class="photo-counter" id="photoCounter">1 / 3</div>
        <div class="photo-slider" id="photoSlider">
            <div class="photo-slide">
                <img class="photo-slide-img" src="images/Photo_1.jpg" alt="Фото работы 1">
            </div>
            <div class="photo-slide">
                <img class="photo-slide-img" src="images/Photo_2.jpg" alt="Фото работы 2">
            </div>
            <div class="photo-slide">
                <img class="photo-slide-img" src="images/Photo_3.jpg" alt="Фото работы 3">
            </div>
        </div>
        <div class="photo-dots" id="photoDots">
            <div class="photo-dot active" data-index="0"></div>
            <div class="photo-dot" data-index="1"></div>
            <div class="photo-dot" data-index="2"></div>
        </div>
    </div>
</div>

<!-- Экран авторизации -->
<div id="authScreen" class="screen">
    <div class="auth-container">
        <div class="input-group">
            <div class="input-label">Логин</div>
            <input type="text" id="loginInput" class="input-field" placeholder="Введите логин">
        </div>
        <div class="input-group">
            <div class="input-label">Пароль</div>
            <input type="password" id="passwordInput" class="input-field" placeholder="Введите пароль">
        </div>
        <button id="loginBtn" class="auth-btn">Войти</button>
    </div>
</div>

<!-- Главный экран с таббаром -->
<div id="mainScreen" class="screen">
    <!-- Контент для вкладки "Мои автомобили" -->
    <div id="carsTab" class="content">
        <h1 class="page-title">Мои автомобили</h1>

        <div class="car-card" data-car-id="1">
            <div class="car-header">
                <div class="car-title">Toyota Camry</div>
                <div class="car-plate">A123MP | 18</div>
            </div>
            <div class="car-mileage">Пробег: 85 430 км</div>
        </div>

        <div class="car-card" data-car-id="2">
            <div class="car-header">
                <div class="car-title">Honda Civic</div>
                <div class="car-plate">C404ТО | 777</div>
            </div>
            <div class="car-mileage">Пробег: 42 150 км</div>
        </div>
    </div>

    <!-- Контент для вкладки "Профиль" -->
    <div id="profileTab" class="content" style="display: none;">
        <h1 class="page-title">Профиль</h1>

        <div class="profile-section">
            <div class="profile-info">
                <div class="detail-label">ФИО</div>
                <div class="detail-value">Иванов Иван Иванович</div>
            </div>
            <div class="profile-info">
                <div class="detail-label">Телефон</div>
                <div class="detail-value">+7 (999) 123-45-67</div>
            </div>
            <div class="profile-info">
                <div class="detail-label">Email</div>
                <div class="detail-value">ivanov@example.com</div>
            </div>
        </div>

        <button class="action-btn btn-primary">Написать менеджеру</button>
        <button class="action-btn btn-secondary">Позвонить в сервис</button>
        <button id="logoutBtn" class="logout-btn">Выйти</button>
    </div>

    <!-- Таббар -->
    <div class="tabbar">
        <div class="tab active" data-tab="cars">
            <div class="tab-icon"></div>
            <div>Мои автомобили</div>
        </div>
        <div class="tab" data-tab="profile">
            <div class="tab-icon"></div>
            <div>Профиль</div>
        </div>
    </div>
</div>

<!-- Экран деталей автомобиля -->
<div id="carDetailScreen" class="screen">
    <div class="content">
        <h1 class="page-title" id="carDetailTitle">Toyota Camry</h1>

        <div class="car-detail-section">
            <div class="detail-row">
                <div class="detail-label">Марка и модель</div>
                <div class="detail-value">Toyota Camry</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">Гос. номер</div>
                <div class="detail-value">A123МР | 18</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">VIN</div>
                <div class="detail-value">JTDKB20U087789123</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">Пробег</div>
                <div class="detail-value">85 430 км</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">Год выпуска</div>
                <div class="detail-value">2018</div>
            </div>
        </div>

        <button id="viewHistoryBtn" class="action-btn btn-primary">Посмотреть историю</button>
        <button id="bookOnlineBtn" class="action-btn btn-secondary">Записаться онлайн</button>
    </div>
</div>

<!-- Экран истории визитов -->
<div id="historyScreen" class="screen">
    <div class="content">
        <h1 class="page-title">История визитов</h1>

        <div class="visit-card" data-visit-id="1">
            <div class="visit-date">15 марта 2024</div>
            <div class="visit-services">Замена масла в ДВС, замена масляного фильтра, замена воздушного фильтра</div>
            <div class="visit-mileage">Пробег: 85 430 км</div>
        </div>

        <div class="visit-card" data-visit-id="2">
            <div class="visit-date">10 января 2024</div>
            <div class="visit-services">Замена антифриза, промывка радиатора</div>
            <div class="visit-mileage">Пробег: 82 150 км</div>
        </div>
    </div>
</div>

<!-- Экран деталей визита -->
<div id="visitDetailScreen" class="screen">
    <div class="content">
        <h1 class="page-title">Детали визита</h1>

        <div class="car-detail-section">
            <div class="detail-row">
                <div class="detail-label">Дата</div>
                <div class="detail-value">15 марта 2024</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">Пробег</div>
                <div class="detail-value">85 430 км</div>
            </div>
        </div>

        <h2 style="font-size: 18px; margin: 20px 0 12px 0; color: #1a1a1a;">Выполненные работы</h2>

        <div class="service-item">
            <div class="service-name">Замена масла в ДВС</div>
        </div>
        <div class="service-item">
            <div class="service-name">Замена масляного фильтра</div>
        </div>
        <div class="service-item">
            <div class="service-name">Замена воздушного фильтра</div>
        </div>

        <h2 style="font-size: 18px; margin: 20px 0 12px 0; color: #1a1a1a;">Фотографии работ</h2>

        <div class="photo-gallery">
            <div class="photo-item" data-photo-index="0" style="background-image: url('images/Photo_1.jpg')"></div>
            <div class="photo-item" data-photo-index="1" style="background-image: url('images/Photo_2.jpg')"></div>
            <div class="photo-item" data-photo-index="2" style="background-image: url('images/Photo_3.jpg')"></div>
        </div>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;

    // Инициализация WebApp
    tg.ready();
    tg.expand();
    tg.enableClosingConfirmation();
    tg.BackButton.hide();

    // Текущий экран
    let currentScreen = 'auth';

    // Переменные для просмотра фотографий
    let currentPhotoIndex = 0;
    const totalPhotos = 3;
    let startX = 0;
    let currentX = 0;
    let isSwiping = false;

    // Функции навигации
    function showScreen(screenName) {
        console.log('Переход на экран:', screenName);

        // Скрыть все экраны
        document.querySelectorAll('.screen').forEach(screen => {
            screen.classList.remove('active');
        });

        // Показать нужный экран
        const targetScreen = document.getElementById(screenName + 'Screen');
        if (targetScreen) {
            targetScreen.classList.add('active');
        } else {
            console.error('Экран не найден:', screenName);
        }

        currentScreen = screenName;
        updateBackButton();
    }

    function updateBackButton() {
        switch(currentScreen) {
            case 'auth':
            case 'main':
                tg.BackButton.hide();
                break;
            case 'carDetail':
            case 'history':
            case 'visitDetail':
                tg.BackButton.show();
                tg.BackButton.offClick(goBack);
                tg.BackButton.onClick(goBack);
                break;
        }
    }

    function goBack() {
        switch(currentScreen) {
            case 'carDetail':
                showScreen('main');
                break;
            case 'history':
                showScreen('carDetail');
                break;
            case 'visitDetail':
                showScreen('history');
                break;
        }
    }

    // Функции для просмотра фотографий
    function openPhotoViewer(startIndex = 0) {
        currentPhotoIndex = startIndex;
        updatePhotoViewer();
        document.getElementById('photoViewer').classList.add('active');
    }

    function closePhotoViewer() {
        document.getElementById('photoViewer').classList.remove('active');
    }

    function updatePhotoViewer() {
        const photoSlider = document.getElementById('photoSlider');
        const photoCounter = document.getElementById('photoCounter');
        const photoDots = document.querySelectorAll('.photo-dot');

        // Обновляем позицию слайдера
        photoSlider.style.transform = `translateX(-${currentPhotoIndex * 100}%)`;

        photoCounter.textContent = `${currentPhotoIndex + 1} / ${totalPhotos}`;

        // Обновляем точки
        photoDots.forEach((dot, index) => {
            dot.classList.toggle('active', index === currentPhotoIndex);
        });
    }

    function showPhoto(index) {
        if (index >= 0 && index < totalPhotos) {
            currentPhotoIndex = index;
            updatePhotoViewer();
        }
    }

    function showNextPhoto() {
        if (currentPhotoIndex < totalPhotos - 1) {
            currentPhotoIndex++;
            updatePhotoViewer();
        }
    }

    function showPrevPhoto() {
        if (currentPhotoIndex > 0) {
            currentPhotoIndex--;
            updatePhotoViewer();
        }
    }

    // Функции для свайпа
    function handleTouchStart(e) {
        startX = e.touches[0].clientX;
        currentX = startX;
        isSwiping = true;
    }

    function handleTouchMove(e) {
        if (!isSwiping) return;
        currentX = e.touches[0].clientX;
        const diff = currentX - startX;

        // Блокируем вертикальный скролл во время горизонтального свайпа
        if (Math.abs(diff) > 10) {
            e.preventDefault();
        }
    }

    function handleTouchEnd(e) {
        if (!isSwiping) return;

        const diff = currentX - startX;
        const threshold = 50; // Минимальное расстояние свайпа

        if (Math.abs(diff) > threshold) {
            if (diff > 0) {
                // Свайп вправо - предыдущая фотография
                showPrevPhoto();
            } else {
                // Свайп влево - следующая фотография
                showNextPhoto();
            }
        }

        isSwiping = false;
    }

    // Инициализация при загрузке
    document.addEventListener('DOMContentLoaded', () => {
        // Сплеш-скрин
        setTimeout(() => {
            document.getElementById('splash').classList.add('hidden');
            showScreen('auth');
        }, 1500);

        // Авторизация
        document.getElementById('loginBtn').addEventListener('click', () => {
            const login = document.getElementById('loginInput').value;
            const password = document.getElementById('passwordInput').value;

            // Любой логин/пароль подходит для прототипа
            if (login && password) {
                showScreen('main');
            } else {
                // Просто показываем главный экран даже если поля пустые (для тестирования)
                showScreen('main');
            }
        });

        // Таббар
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-tab');

                // Обновить активную вкладку
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                // Показать соответствующий контент
                document.getElementById('carsTab').style.display = 'none';
                document.getElementById('profileTab').style.display = 'none';
                document.getElementById(tabName + 'Tab').style.display = 'block';
            });
        });

        // Навигация по автомобилям
        document.querySelectorAll('.car-card').forEach(card => {
            card.addEventListener('click', () => {
                const carId = card.getAttribute('data-car-id');
                console.log('Клик по автомобилю:', carId);
                showScreen('carDetail');
            });
        });

        // Кнопки на странице автомобиля
        document.getElementById('viewHistoryBtn').addEventListener('click', () => {
            showScreen('history');
        });

        document.getElementById('bookOnlineBtn').addEventListener('click', () => {
            // Заглушка для записи онлайн
            tg.showPopup({
                title: 'Запись онлайн',
                message: 'Функция записи онлайн будет доступна в полной версии приложения',
                buttons: [{ type: 'ok' }]
            });
        });

        // Навигация по истории
        document.querySelectorAll('.visit-card').forEach(card => {
            card.addEventListener('click', () => {
                const visitId = card.getAttribute('data-visit-id');
                console.log('Клик по визиту:', visitId);
                showScreen('visitDetail');
            });
        });

        // Просмотр фотографий
        document.querySelectorAll('.photo-item').forEach(photo => {
            photo.addEventListener('click', () => {
                const photoIndex = parseInt(photo.getAttribute('data-photo-index'));
                openPhotoViewer(photoIndex);
            });
        });

        // Управление просмотром фотографий
        document.getElementById('closeViewer').addEventListener('click', closePhotoViewer);

        // Навигация по фотографиям через точки
        document.querySelectorAll('.photo-dot').forEach(dot => {
            dot.addEventListener('click', () => {
                const index = parseInt(dot.getAttribute('data-index'));
                showPhoto(index);
            });
        });

        // Свайп для фотографий
        const photoViewerContent = document.getElementById('photoViewerContent');
        photoViewerContent.addEventListener('touchstart', handleTouchStart, { passive: true });
        photoViewerContent.addEventListener('touchmove', handleTouchMove, { passive: false });
        photoViewerContent.addEventListener('touchend', handleTouchEnd, { passive: true });

        // Закрытие просмотра по клику на фон
        document.getElementById('photoViewer').addEventListener('click', (e) => {
            if (e.target === document.getElementById('photoViewer')) {
                closePhotoViewer();
            }
        });

        // Выход из системы
        document.getElementById('logoutBtn').addEventListener('click', () => {
            showScreen('auth');
            // Очищаем поля ввода
            document.getElementById('loginInput').value = '';
            document.getElementById('passwordInput').value = '';
        });

        // Блокировка свайпа вниз
        document.body.addEventListener('touchmove', (e) => {
            if (e.target === document.body) {
                e.preventDefault();
            }
        }, { passive: false });

        // Также добавляем Enter для авторизации
        document.getElementById('passwordInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('loginBtn').click();
            }
        });
    });
</script>
</body>
</html>
