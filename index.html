<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Автосервис - Личный кабинет</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<!-- Splash Screen -->
<div id="splash">
    <div class="splash-logo">
        <i class="fas fa-car-crash"></i>
    </div>
</div>

<!-- Auth Form -->
<div id="auth-view" class="container">
    <div class="auth-container">
        <div class="auth-header">
            <div class="app-logo">
                <i class="fas fa-car-crash"></i>
            </div>
            <h1 class="auth-title">MCSERVICE "Планета Авто"</h1>
            <p class="auth-subtitle">Кузовной ремонт и обслуживание</p>
        </div>

        <form id="login-form" class="auth-form">
            <div class="form-group">
                <label for="username" class="form-label">Логин</label>
                <input type="text" id="username" class="form-input" placeholder="Введите ваш логин" required>
            </div>

            <div class="form-group">
                <label for="password" class="form-label">Пароль</label>
                <input type="password" id="password" class="form-input" placeholder="Введите ваш пароль" required>
            </div>

            <button type="submit" class="btn btn-primary btn-block">
                <i class="fas fa-sign-in-alt"></i> Войти
            </button>
        </form>

        <p class="footer-text">© 2025 MCSERVICE "Планета Авто". Все права защищены.</p>
    </div>
</div>

<!-- Клиентское приложение -->
<div id="app">
    <div class="app-header">
        <h1 class="app-title" id="current-screen-title">Мои автомобили</h1>
    </div>

    <div class="main-content" id="main-content">
        <!-- Cars List View -->
        <div id="cars-list-view">
            <div class="car-card" data-car-id="1" onclick="App.showCarDetails(1)">
                <div class="car-status">В работе</div>
                <h2><i class="fas fa-car"></i> Volkswagen Tiguan</h2>
                <p>Госномер: А123БВ777</p>
                <p>Статус: Дефектовка</p>
                <div class="car-meta">
                    <span><i class="fas fa-tachometer-alt"></i> 45 230 км</span>
                    <span><i class="fas fa-wrench"></i> Кузовной ремонт</span>
                </div>
            </div>

            <div class="car-card" data-car-id="2" onclick="App.showCarDetails(2)">
                <div class="car-status completed">Готов</div>
                <h2><i class="fas fa-car"></i> Kia Sportage</h2>
                <p>Госномер: Х987УК177</p>
                <p>Статус: Готов к выдаче</p>
                <div class="car-meta">
                    <span><i class="fas fa-tachometer-alt"></i> 18 750 км</span>
                    <span><i class="fas fa-wrench"></i> Покраска</span>
                </div>
            </div>
        </div>

        <!-- Car Details View (hidden by default) -->
        <div id="car-details-view" style="display: none;">
            <div class="car-details">
                <h2><i class="fas fa-car"></i> <span id="car-model">Volkswagen Tiguan</span></h2>

                <div class="car-image">
                    <i class="fas fa-car"></i>
                </div>

                <div class="detail-row">
                    <span class="detail-label">Госномер:</span>
                    <span class="detail-value" id="car-plate">А123БВ777</span>
                </div>

                <div class="detail-row">
                    <span class="detail-label">VIN:</span>
                    <span class="detail-value" id="car-vin">WVGZZZ5NZJW123456</span>
                </div>

                <div class="detail-row">
                    <span class="detail-label">Год выпуска:</span>
                    <span class="detail-value" id="car-year">2019</span>
                </div>

                <div class="detail-row">
                    <span class="detail-label">Пробег:</span>
                    <span class="detail-value" id="car-mileage">45 230 км</span>
                </div>

                <div class="detail-row">
                    <span class="detail-label">Статус:</span>
                    <span class="detail-value" id="car-status">В работе</span>
                </div>

                <div class="detail-row">
                    <span class="detail-label">Тип работ:</span>
                    <span class="detail-value" id="car-work-type">Кузовной ремонт</span>
                </div>
            </div>

            <!-- Repair Status Timeline -->
            <div class="repair-status" id="repair-status-section">
                <h3><i class="fas fa-tasks"></i> Статус ремонта</h3>
                <div class="status-timeline" id="status-timeline">
                    <!-- Filled dynamically by JavaScript -->
                </div>
            </div>

            <!-- Photo Gallery -->
            <div class="photo-gallery" id="photo-gallery-section">
                <h3><i class="fas fa-camera"></i> Фотоотчет по ремонту</h3>
                <div class="gallery-container" id="gallery-container">
                    <!-- Filled dynamically by JavaScript -->
                </div>
            </div>

            <!-- Documents Section -->
            <div class="documents-section" id="documents-section">
                <h3><i class="fas fa-file-alt"></i> Документы</h3>
                <div class="document-list" id="document-list">
                    <!-- Filled dynamically by JavaScript -->
                </div>
            </div>

            <button class="btn btn-primary btn-block" onclick="App.showServiceHistory()" style="margin-top: 20px;">
                <i class="fas fa-history"></i> История обслуживания
            </button>
        </div>

        <!-- History View (hidden by default) -->
        <div id="history-view" style="display: none;">
            <div class="history-list">
                <h2><i class="fas fa-history"></i> История обслуживания</h2>

                <div class="history-item">
                    <h3><span class="history-date">15.04.2023</span> - Кузовной ремонт</h3>
                    <p><i class="fas fa-car-crash"></i> Устранение повреждений правого борта</p>
                    <p><i class="fas fa-tachometer-alt"></i> Пробег: 45 230 км</p>
                    <p><i class="fas fa-ruble-sign"></i> Стоимость: 87 500 руб.</p>
                    <div class="parts-list">
                        <p><strong>Запчасти:</strong></p>
                        <ul>
                            <li>Крыло правое - 32 500 руб.</li>
                            <li>Покраска - 55 000 руб.</li>
                        </ul>
                    </div>
                </div>

                <div class="history-item">
                    <h3><span class="history-date">10.01.2023</span> - Плановое ТО</h3>
                    <p><i class="fas fa-oil-can"></i> Замена масла и фильтров</p>
                    <p><i class="fas fa-tachometer-alt"></i> Пробег: 42 000 км</p>
                    <p><i class="fas fa-ruble-sign"></i> Стоимость: 12 500 руб.</p>
                </div>
            </div>
        </div>

        <!-- Profile View (hidden by default) -->
        <div id="profile-view" style="display: none;">
            <div class="profile-view">
                <h2><i class="fas fa-user"></i> Мой профиль</h2>

                <div class="profile-info">
                    <p><strong><i class="fas fa-user-tie"></i> Имя:</strong> Иван Петров</p>
                    <p><strong><i class="fas fa-phone"></i> Телефон:</strong> +7 (912) 345-67-89</p>
                    <p><strong><i class="fas fa-envelope"></i> Email:</strong> ivan.petrov@example.com</p>
                    <p><strong><i class="fas fa-car"></i> Автомобилей:</strong> 2</p>
                </div>

                <div class="profile-actions">
                    <button class="btn btn-secondary btn-block" onclick="App.showGames()">
                        <i class="fas fa-gamepad"></i> Игры
                    </button>
                    <button class="btn btn-secondary btn-block" onclick="App.writeToManager()">
                        <i class="fas fa-comment-dots"></i> Написать менеджеру
                    </button>
                    <button class="btn btn-secondary btn-block" onclick="App.callService()">
                        <i class="fas fa-phone-alt"></i> Позвонить в автосервис
                    </button>
                </div>

                <button class="btn btn-primary btn-block" onclick="App.logout()">
                    <i class="fas fa-sign-out-alt"></i> Выйти
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Администраторская панель -->
<div class="admin-container" id="adminSection">
    <div class="admin-header">
        <h1>Автосервис - Панель администратора</h1>
    </div>

    <div class="tab-container">
        <div class="tab active" onclick="openTab('cars')">Авто</div>
        <div class="tab" onclick="openTab('clients')">Клиенты</div>
        <div class="tab" onclick="openTab('profile')">Профиль</div>
    </div>

    <!-- Вкладка автомобилей -->
    <div id="cars" class="tab-content active">
        <div class="search-box">
            <input type="text" id="car-search" placeholder="Поиск по гос. номеру, марке, модели..." onkeyup="searchCars()">
            <button class="btn btn-primary" onclick="showAddCarForm()" style="margin-top: 10px;">
                <i class="fas fa-plus"></i> Добавить автомобиль
            </button>
        </div>

        <div id="add-car-form" style="display: none; margin-bottom: 20px;">
            <h3>Добавить новый автомобиль</h3>
            <div class="form-group">
                <label for="car-number">Гос. номер:</label>
                <input type="text" id="car-number" placeholder="А123БВ777">
            </div>
            <div class="form-group">
                <label for="car-brand">Марка:</label>
                <input type="text" id="car-brand" placeholder="Toyota">
            </div>
            <div class="form-group">
                <label for="car-model">Модель:</label>
                <input type="text" id="car-model" placeholder="Camry">
            </div>
            <div class="form-group">
                <label for="car-year">Год выпуска:</label>
                <input type="number" id="car-year" placeholder="2018">
            </div>
            <div class="form-group">
                <label for="car-vin">VIN:</label>
                <input type="text" id="car-vin" placeholder="XTA210997654321">
            </div>
            <div class="form-group">
                <label for="car-status">Статус:</label>
                <select id="car-status">
                    <option value="diagnostic">Дефектовка</option>
                    <option value="repair">Ремонт</option>
                    <option value="painting">Покраска</option>
                    <option value="ready">Готов к выдаче</option>
                    <option value="completed">Выдан клиенту</option>
                </select>
            </div>
            <div class="form-group">
                <label for="car-description">Описание работ:</label>
                <textarea id="car-description"></textarea>
            </div>
            <button class="btn btn-success" onclick="addCar()">Добавить</button>
            <button class="btn btn-secondary" onclick="hideAddCarForm()">Отмена</button>
        </div>

        <table id="cars-table">
            <thead>
            <tr>
                <th>Гос. номер</th>
                <th>Марка</th>
                <th>Модель</th>
                <th>Статус</th>
            </tr>
            </thead>
            <tbody id="cars-table-body">
            <!-- Данные будут загружаться динамически -->
            <tr>
                <td>А123БВ777</td>
                <td>Volkswagen</td>
                <td>Tiguan</td>
                <td>
                    <select class="status-select" onchange="updateCarStatus(1, this.value)">
                        <option value="diagnostic" selected>Дефектовка</option>
                        <option value="repair">Ремонт</option>
                        <option value="painting">Покраска</option>
                        <option value="ready">Готов к выдаче</option>
                        <option value="completed">Выдан клиенту</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>Х987УК177</td>
                <td>Kia</td>
                <td>Sportage</td>
                <td>
                    <select class="status-select" onchange="updateCarStatus(2, this.value)">
                        <option value="diagnostic">Дефектовка</option>
                        <option value="repair">Ремонт</option>
                        <option value="painting">Покраска</option>
                        <option value="ready" selected>Готов к выдаче</option>
                        <option value="completed">Выдан клиенту</option>
                    </select>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- Вкладка клиентов -->
    <div id="clients" class="tab-content">
        <div class="search-box">
            <input type="text" id="client-search" placeholder="Поиск по имени, телефону или автомобилю..." onkeyup="searchClients()">
        </div>

        <table id="clients-table">
            <thead>
            <tr>
                <th>Имя</th>
                <th>Телефон</th>
                <th>Автомобиль</th>
                <th>Статус</th>
            </tr>
            </thead>
            <tbody id="clients-table-body">
            <!-- Данные будут загружаться динамически -->
            <tr>
                <td>Иван Петров</td>
                <td>+7 (912) 345-67-89</td>
                <td>VW Tiguan (А123БВ777)</td>
                <td><span class="status-in-progress">В ремонте</span></td>
            </tr>
            <tr>
                <td>Мария Сидорова</td>
                <td>+7 (912) 987-65-43</td>
                <td>Kia Sportage (Х987УК177)</td>
                <td><span class="status-completed">Готов</span></td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- Вкладка профиля -->
    <div id="profile" class="tab-content">
        <div class="profile-view">
            <h2><i class="fas fa-user-cog"></i> Профиль администратора</h2>

            <div class="profile-info">
                <p><strong><i class="fas fa-user-tie"></i> Имя:</strong> Администратор Системы</p>
                <p><strong><i class="fas fa-phone"></i> Телефон:</strong> +7 (900) 123-45-67</p>
                <p><strong><i class="fas fa-envelope"></i> Email:</strong> admin@autoservice.ru</p>
                <p><strong><i class="fas fa-calendar-alt"></i> Последний вход:</strong> 12.08.2025 14:30</p>
            </div>

            <div class="profile-actions">
                <button class="btn btn-secondary btn-block" onclick="changePassword()">
                    <i class="fas fa-key"></i> Сменить пароль
                </button>
                <button class="btn btn-secondary btn-block" onclick="systemSettings()">
                    <i class="fas fa-cog"></i> Настройки системы
                </button>
            </div>

            <button class="btn btn-primary btn-block" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Выйти
            </button>
        </div>
    </div>
</div>

<!-- Games Modal -->
<div id="games-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Игры</h3>
            <button class="modal-close" onclick="App.hideGames()">&times;</button>
        </div>
        <div class="games-list">
            <div class="game-item" onclick="App.openGame('2048')">
                <div class="game-icon">
                    <i class="fas fa-th"></i>
                </div>
                <div class="game-info">
                    <div class="game-name">2048</div>
                    <div class="game-desc">Соберите плитку 2048</div>
                </div>
            </div>
            <div class="game-item" onclick="App.openGame('snake')">
                <div class="game-icon">
                    <i class="fas fa-snake"></i>
                </div>
                <div class="game-info">
                    <div class="game-name">Змейка</div>
                    <div class="game-desc">Классическая змейка</div>
                </div>
            </div>
            <div class="game-item" onclick="App.openGame('tetris')">
                <div class="game-icon">
                    <i class="fas fa-shapes"></i>
                </div>
                <div class="game-info">
                    <div class="game-name">Тетрис</div>
                    <div class="game-desc">Собирайте линии</div>
                </div>
            </div>
            <div class="game-item" onclick="App.openGame('minesweeper')">
                <div class="game-icon">
                    <i class="fas fa-bomb"></i>
                </div>
                <div class="game-info">
                    <div class="game-name">Сапер</div>
                    <div class="game-desc">Найдите все мины</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tabbar для пользователя (по умолчанию) -->
<div class="tabbar" id="user-tabbar">
    <a href="#" class="tabbar-item active" id="main-tab" onclick="App.navigateTo('main')">
        <span class="tabbar-icon"><i class="fas fa-car"></i></span>
        <span>Авто</span>
    </a>
    <a href="#" class="tabbar-item" id="history-tab" onclick="App.navigateTo('history')">
        <span class="tabbar-icon"><i class="fas fa-history"></i></span>
        <span>История</span>
    </a>
    <a href="#" class="tabbar-item" id="profile-tab" onclick="App.navigateTo('profile')">
        <span class="tabbar-icon"><i class="fas fa-user"></i></span>
        <span>Профиль</span>
    </a>
</div>

<!-- Tabbar для администратора (скрыт по умолчанию) -->
<div class="tabbar" id="admin-tabbar" style="display: none;">
    <a href="#" class="tabbar-item active" onclick="openTab('cars')">
        <span class="tabbar-icon"><i class="fas fa-car"></i></span>
        <span>Авто</span>
    </a>
    <a href="#" class="tabbar-item" onclick="openTab('clients')">
        <span class="tabbar-icon"><i class="fas fa-users"></i></span>
        <span>Клиенты</span>
    </a>
    <a href="#" class="tabbar-item" onclick="openTab('profile')">
        <span class="tabbar-icon"><i class="fas fa-user-cog"></i></span>
        <span>Профиль</span>
    </a>
</div>

<script>
    // Клиентское приложение
    const App = {
        currentView: 'main',
        currentCar: null,

        init() {
            // Show auth form after splash
            setTimeout(() => {
                document.getElementById('splash').style.opacity = '0';
                document.getElementById('auth-view').classList.add('show');

                setTimeout(() => {
                    document.getElementById('splash').style.display = 'none';
                }, 500);

                // Focus on username field
                document.getElementById('username').focus();
            }, 1500);

            // Handle login form
            document.getElementById('login-form').onsubmit = (e) => {
                e.preventDefault();
                this.handleLogin();
            };
        },

        handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            // Simple validation
            if (!username || !password) {
                alert('Введите логин и пароль');
                return;
            }

            // Hide auth form
            document.getElementById('auth-view').style.opacity = '0';

            setTimeout(() => {
                document.getElementById('auth-view').style.display = 'none';

                if (username === '1' && password === '1') {
                    // Regular user
                    document.getElementById('app').classList.add('show');
                    document.getElementById('user-tabbar').style.display = 'flex';
                    document.getElementById('admin-tabbar').style.display = 'none';
                    this.navigateTo('main');
                } else if (username === '2' && password === '2') {
                    // Admin user
                    document.getElementById('adminSection').style.display = 'block';
                    document.getElementById('user-tabbar').style.display = 'none';
                    document.getElementById('admin-tabbar').style.display = 'flex';
                    document.getElementById('app').style.display = 'none';
                    initTestData();
                } else {
                    alert('Неверный логин или пароль');
                    document.getElementById('auth-view').style.display = 'flex';
                    document.getElementById('auth-view').style.opacity = '1';
                }
            }, 500);
        },

        showApp() {
            document.getElementById('app').classList.add('show');
            this.navigateTo('main');
        },

        navigateTo(view) {
            this.currentView = view;

            // Update active tab
            document.querySelectorAll('#user-tabbar .tabbar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.getElementById(`${view}-tab`).classList.add('active');

            // Update title
            const titles = {
                'main': 'Мои автомобили',
                'history': 'История обслуживания',
                'profile': 'Мой профиль'
            };
            document.getElementById('current-screen-title').textContent = titles[view];

            // Show appropriate view
            document.getElementById('cars-list-view').style.display = 'none';
            document.getElementById('car-details-view').style.display = 'none';
            document.getElementById('history-view').style.display = 'none';
            document.getElementById('profile-view').style.display = 'none';

            switch(view) {
                case 'main':
                    document.getElementById('cars-list-view').style.display = 'block';
                    break;
                case 'history':
                    document.getElementById('history-view').style.display = 'block';
                    break;
                case 'profile':
                    document.getElementById('profile-view').style.display = 'block';
                    break;
            }
        },

        showCarDetails(carId) {
            this.currentCar = carId;

            // In a real app, we would fetch car details from API
            const cars = {
                1: {
                    model: 'Volkswagen Tiguan',
                    plate: 'А123БВ777',
                    vin: 'WVGZZZ5NZJW123456',
                    year: '2019',
                    mileage: '45 230 км',
                    status: 'Дефектовка',
                    workType: 'Кузовной ремонт',
                    repairStatus: [
                        {
                            id: 1,
                            date: '10.05.2023',
                            title: 'Приемка автомобиля',
                            description: 'Автомобиль принят на ремонт после ДТП',
                            status: 'completed',
                            photos: [
                                {
                                    url: 'https://example.com/photo1.jpg',
                                    caption: 'Передний вид с повреждениями'
                                },
                                {
                                    url: 'https://example.com/photo2.jpg',
                                    caption: 'Правая сторона с вмятинами'
                                }
                            ]
                        },
                        {
                            id: 2,
                            date: '12.05.2023',
                            title: 'Дефектовка',
                            description: 'Проведена дефектовка кузова, составлена смета',
                            status: 'completed',
                            photos: [
                                {
                                    url: 'https://example.com/photo3.jpg',
                                    caption: 'Дефектовка передней части'
                                }
                            ]
                        },
                        {
                            id: 3,
                            date: '15.05.2023',
                            title: 'Разборка и ремонт кузова',
                            description: 'Демонтированы поврежденные элементы, начат ремонт кузова',
                            status: 'active',
                            photos: [
                                {
                                    url: 'https://example.com/photo4.jpg',
                                    caption: 'Процесс ремонта правого крыла'
                                },
                                {
                                    url: 'https://example.com/photo5.jpg',
                                    caption: 'Подготовка к покраске'
                                }
                            ]
                        },
                        {
                            id: 4,
                            date: '18.05.2023',
                            title: 'Покраска',
                            description: 'Запланирована покраска восстановленных элементов',
                            status: 'pending'
                        },
                        {
                            id: 5,
                            date: '20.05.2023',
                            title: 'Сборка и полировка',
                            description: 'Сборка автомобиля и финальная полировка',
                            status: 'pending'
                        },
                        {
                            id: 6,
                            date: '22.05.2023',
                            title: 'Готов к выдаче',
                            description: 'Автомобиль прошел контроль качества',
                            status: 'pending'
                        }
                    ],
                    documents: [
                        {
                            id: 1,
                            name: 'Смета ремонта',
                            type: 'pdf',
                            date: '12.05.2023',
                            size: '2.4 MB',
                            url: 'https://example.com/estimate.pdf'
                        },
                        {
                            id: 2,
                            name: 'Акт выполненных работ',
                            type: 'pdf',
                            date: '22.05.2023',
                            size: '1.8 MB',
                            url: 'https://example.com/act.pdf'
                        },
                        {
                            id: 3,
                            name: 'Чек об оплате',
                            type: 'pdf',
                            date: '22.05.2023',
                            size: '0.5 MB',
                            url: 'https://example.com/receipt.pdf'
                        }
                    ]
                },
                2: {
                    model: 'Kia Sportage',
                    plate: 'Х987УК177',
                    vin: 'KNDPMCAC5M7123456',
                    year: '2021',
                    mileage: '18 750 км',
                    status: 'Готов к выдаче',
                    workType: 'Покраска',
                    repairStatus: [
                        {
                            id: 1,
                            date: '01.05.2023',
                            title: 'Приемка автомобиля',
                            description: 'Автомобиль принят на покраску',
                            status: 'completed'
                        },
                        {
                            id: 2,
                            date: '03.05.2023',
                            title: 'Подготовка к покраске',
                            description: 'Поверхности подготовлены к покраске',
                            status: 'completed'
                        },
                        {
                            id: 3,
                            date: '05.05.2023',
                            title: 'Покраска',
                            description: 'Элементы кузова покрашены',
                            status: 'completed'
                        },
                        {
                            id: 4,
                            date: '07.05.2023',
                            title: 'Полировка',
                            description: 'Проведена финальная полировка',
                            status: 'completed'
                        },
                        {
                            id: 5,
                            date: '08.05.2023',
                            title: 'Готов к выдаче',
                            description: 'Автомобиль прошел контроль качества',
                            status: 'completed'
                        }
                    ],
                    documents: [
                        {
                            id: 1,
                            name: 'Смета покраски',
                            type: 'pdf',
                            date: '03.05.2023',
                            size: '1.2 MB',
                            url: 'https://example.com/paint_estimate.pdf'
                        },
                        {
                            id: 2,
                            name: 'Акт выполненных работ',
                            type: 'pdf',
                            date: '08.05.2023',
                            size: '1.5 MB',
                            url: 'https://example.com/paint_act.pdf'
                        }
                    ]
                }
            };

            const car = cars[carId];

            // Update car details
            document.getElementById('car-model').textContent = car.model;
            document.getElementById('car-plate').textContent = car.plate;
            document.getElementById('car-vin').textContent = car.vin;
            document.getElementById('car-year').textContent = car.year;
            document.getElementById('car-mileage').textContent = car.mileage;
            document.getElementById('car-status').textContent = car.status;
            document.getElementById('car-work-type').textContent = car.workType;

            // Update repair status timeline
            this.updateRepairStatus(car.repairStatus);

            // Update photo gallery
            this.updatePhotoGallery(car.repairStatus);

            // Update documents
            this.updateDocuments(car.documents);

            // Show/hide sections based on repair status
            document.getElementById('repair-status-section').style.display = car.status === 'Готов к выдаче' ? 'none' : 'block';
            document.getElementById('photo-gallery-section').style.display = car.repairStatus.some(s => s.photos && s.photos.length > 0) ? 'block' : 'none';
            document.getElementById('documents-section').style.display = car.documents && car.documents.length > 0 ? 'block' : 'none';

            // Show car details view
            document.getElementById('cars-list-view').style.display = 'none';
            document.getElementById('car-details-view').style.display = 'block';
            document.getElementById('current-screen-title').textContent = car.model;
        },

        updateRepairStatus(statusItems) {
            const timeline = document.getElementById('status-timeline');
            timeline.innerHTML = '';

            statusItems.forEach(item => {
                const statusItem = document.createElement('div');
                statusItem.className = `status-item ${item.status}`;

                statusItem.innerHTML = `
                        <div class="status-dot"></div>
                        <div class="status-date">${item.date}</div>
                        <div class="status-title">${item.title}</div>
                        <div class="status-desc">${item.description}</div>
                    `;

                timeline.appendChild(statusItem);
            });
        },

        updatePhotoGallery(repairStatus) {
            const gallery = document.getElementById('gallery-container');
            gallery.innerHTML = '';

            // Collect all photos from all status items
            const allPhotos = [];
            repairStatus.forEach(status => {
                if (status.photos && status.photos.length > 0) {
                    status.photos.forEach(photo => {
                        allPhotos.push({
                            ...photo,
                            statusTitle: status.title
                        });
                    });
                }
            });

            if (allPhotos.length === 0) {
                gallery.innerHTML = '<p style="padding: 16px; text-align: center; color: var(--gray);">Фотографии по ремонту пока отсутствуют</p>';
                return;
            }

            allPhotos.forEach(photo => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item';

                galleryItem.innerHTML = `
                        <img src="${photo.url}" alt="Фото ремонта" class="gallery-image" onerror="this.src='data:image/svg+xml;charset=UTF-8,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 300 200\"%3E%3Crect width=\"300\" height=\"200\" fill=\"%23E9ECEF\"/%3E%3Ctext x=\"150\" y=\"100\" font-family=\"Arial\" font-size=\"16\" text-anchor=\"middle\" fill=\"%236C757D\"%3EФото недоступно%3C/text%3E%3C/svg%3E'">
                        <div class="gallery-caption">${photo.statusTitle}: ${photo.caption}</div>
                    `;

                gallery.appendChild(galleryItem);
            });
        },

        updateDocuments(documents) {
            const documentList = document.getElementById('document-list');
            documentList.innerHTML = '';

            if (!documents || documents.length === 0) {
                documentList.innerHTML = '<p style="padding: 16px; text-align: center; color: var(--gray);">Документы пока отсутствуют</p>';
                return;
            }

            documents.forEach(doc => {
                const docItem = document.createElement('div');
                docItem.className = 'document-item';

                const icon = this.getDocumentIcon(doc.type);

                docItem.innerHTML = `
                        <div class="document-icon">
                            <i class="${icon}"></i>
                        </div>
                        <div class="document-info">
                            <div class="document-name">${doc.name}</div>
                            <div class="document-meta">${doc.date} · ${doc.size}</div>
                        </div>
                        <div class="document-actions">
                            <button class="document-btn" onclick="App.downloadDocument('${doc.url}', '${doc.name}')">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="document-btn" onclick="App.shareDocument('${doc.url}', '${doc.name}')">
                                <i class="fas fa-share-alt"></i>
                            </button>
                        </div>
                    `;

                documentList.appendChild(docItem);
            });
        },

        getDocumentIcon(type) {
            switch(type) {
                case 'pdf': return 'fas fa-file-pdf';
                case 'doc':
                case 'docx': return 'fas fa-file-word';
                case 'xls':
                case 'xlsx': return 'fas fa-file-excel';
                case 'jpg':
                case 'png':
                case 'gif': return 'fas fa-file-image';
                default: return 'fas fa-file';
            }
        },

        downloadDocument(url, name) {
            alert(`Документ "${name}" будет скачан с URL: ${url}\n\nВ реальном приложении здесь будет реализовано скачивание файла.`);
        },

        shareDocument(url, name) {
            if (navigator.share) {
                navigator.share({
                    title: name,
                    text: `Документ из автосервиса: ${name}`,
                    url: url
                }).catch(err => {
                    console.error('Ошибка при попытке поделиться:', err);
                    alert('Не удалось поделиться документом. Скопируйте ссылку вручную.');
                });
            } else {
                alert(`Ссылка на документ "${name}": ${url}\n\nСкопируйте и отправьте вручную.`);
            }
        },

        showServiceHistory() {
            this.navigateTo('history');
        },

        showGames() {
            const modal = document.getElementById('games-modal');
            modal.classList.add('show');
            setTimeout(() => {
                modal.style.opacity = '1';
            }, 10);
        },

        hideGames() {
            const modal = document.getElementById('games-modal');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.classList.remove('show');
            }, 300);
        },

        openGame(gameName) {
            alert(`Открываем игру: ${gameName}\nЗдесь будет интеграция с @Zer0_Emission_Bot`);
            this.hideGames();
        },

        writeToManager() {
            alert('Открываем чат с менеджером');
        },

        callService() {
            if (confirm('Позвонить в автосервис по номеру +7 (123) 456-78-90?')) {
                window.location.href = 'tel:+71234567890';
            }
        },

        logout() {
            if (confirm('Вы уверены, что хотите выйти?')) {
                document.getElementById('app').classList.remove('show');
                document.getElementById('adminSection').style.display = 'none';
                document.getElementById('user-tabbar').style.display = 'none';
                document.getElementById('admin-tabbar').style.display = 'none';
                document.getElementById('auth-view').style.display = 'flex';
                document.getElementById('auth-view').style.opacity = '1';

                // Reset form
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('username').focus();
            }
        }
    };

    // Администраторская панель
    let carsDatabase = [];
    let clientsDatabase = [];

    function initTestData() {
        carsDatabase = [
            {
                id: 1,
                number: "А123БВ777",
                brand: "Volkswagen",
                model: "Tiguan",
                year: 2019,
                vin: "WVGZZZ5NZJW123456",
                status: "diagnostic",
                description: "Кузовной ремонт после ДТП",
                clientId: 1
            },
            {
                id: 2,
                number: "Х987УК177",
                brand: "Kia",
                model: "Sportage",
                year: 2021,
                vin: "KNDPMCAC5M7123456",
                status: "ready",
                description: "Покраска переднего бампера",
                clientId: 2
            }
        ];

        clientsDatabase = [
            {
                id: 1,
                name: "Иван Петров",
                phone: "+79123456789",
                email: "ivan.petrov@example.com",
                cars: [1]
            },
            {
                id: 2,
                name: "Мария Сидорова",
                phone: "+79129876543",
                email: "maria.sidorova@example.com",
                cars: [2]
            }
        ];

        updateCarsTable();
        updateClientsTable();
    }

    function openTab(tabId) {
        // Скрыть все вкладки
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });

        // Убрать активный класс у всех табов
        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('active');
        });

        // Показать выбранную вкладку
        document.getElementById(tabId).classList.add('active');

        // Найти соответствующий таб и сделать его активным
        document.querySelector(`.tab[onclick="openTab('${tabId}')"]`).classList.add('active');

        // Обновить активный элемент в таббаре
        document.querySelectorAll('#admin-tabbar .tabbar-item').forEach(item => {
            item.classList.remove('active');
        });
        document.querySelector(`#admin-tabbar .tabbar-item[onclick="openTab('${tabId}')"]`).classList.add('active');
    }

    function showAddCarForm() {
        document.getElementById('add-car-form').style.display = 'block';
    }

    function hideAddCarForm() {
        document.getElementById('add-car-form').style.display = 'none';
    }

    function addCar() {
        const carNumber = document.getElementById('car-number').value;
        const carBrand = document.getElementById('car-brand').value;
        const carModel = document.getElementById('car-model').value;
        const carYear = document.getElementById('car-year').value;
        const carVin = document.getElementById('car-vin').value;
        const carStatus = document.getElementById('car-status').value;
        const carDescription = document.getElementById('car-description').value;

        if (!carNumber || !carBrand || !carModel) {
            alert('Пожалуйста, заполните обязательные поля: гос. номер, марка и модель');
            return;
        }

        const newCar = {
            id: carsDatabase.length > 0 ? Math.max(...carsDatabase.map(c => c.id)) + 1 : 1,
            number: carNumber,
            brand: carBrand,
            model: carModel,
            year: carYear,
            vin: carVin,
            status: carStatus,
            description: carDescription,
            clientId: null
        };

        carsDatabase.push(newCar);

        // Очистка формы
        document.getElementById('car-number').value = '';
        document.getElementById('car-brand').value = '';
        document.getElementById('car-model').value = '';
        document.getElementById('car-year').value = '';
        document.getElementById('car-vin').value = '';
        document.getElementById('car-description').value = '';

        hideAddCarForm();
        updateCarsTable();

        alert('Автомобиль успешно добавлен!');
    }

    function updateCarsTable() {
        const tbody = document.getElementById('cars-table-body');
        tbody.innerHTML = '';

        carsDatabase.forEach(car => {
            const statusText = getStatusText(car.status);
            const statusClass = getStatusClass(car.status);

            const row = document.createElement('tr');
            row.innerHTML = `
                    <td>${car.number}</td>
                    <td>${car.brand}</td>
                    <td>${car.model}</td>
                    <td>
                        <select class="status-select" onchange="updateCarStatus(${car.id}, this.value)" data-car-id="${car.id}">
                            <option value="diagnostic" ${car.status === 'diagnostic' ? 'selected' : ''}>Дефектовка</option>
                            <option value="repair" ${car.status === 'repair' ? 'selected' : ''}>Ремонт</option>
                            <option value="painting" ${car.status === 'painting' ? 'selected' : ''}>Покраска</option>
                            <option value="ready" ${car.status === 'ready' ? 'selected' : ''}>Готов к выдаче</option>
                            <option value="completed" ${car.status === 'completed' ? 'selected' : ''}>Выдан клиенту</option>
                        </select>
                    </td>
                `;

            tbody.appendChild(row);
        });
    }

    function updateCarStatus(carId, newStatus) {
        const car = carsDatabase.find(c => c.id === carId);
        if (car) {
            car.status = newStatus;
            updateClientsTable();
            alert('Статус автомобиля успешно обновлен!');
        }
    }

    function updateClientsTable() {
        const tbody = document.getElementById('clients-table-body');
        tbody.innerHTML = '';

        clientsDatabase.forEach(client => {
            const clientCars = carsDatabase.filter(car => car.clientId === client.id);
            const carInfo = clientCars.length > 0
                ? `${clientCars[0].brand} ${clientCars[0].model} (${clientCars[0].number})`
                : 'Нет автомобилей';

            const status = clientCars.length > 0
                ? carsDatabase.find(car => car.clientId === client.id).status
                : 'none';

            const statusText = getStatusText(status);
            const statusClass = getStatusClass(status);

            const row = document.createElement('tr');
            row.innerHTML = `
                    <td>${client.name}</td>
                    <td>${client.phone}</td>
                    <td>${carInfo}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                `;

            tbody.appendChild(row);
        });
    }

    function getStatusText(status) {
        switch(status) {
            case 'diagnostic': return 'Дефектовка';
            case 'repair': return 'Ремонт';
            case 'painting': return 'Покраска';
            case 'ready': return 'Готов к выдаче';
            case 'completed': return 'Выдан клиенту';
            default: return 'Не определен';
        }
    }

    function getStatusClass(status) {
        switch(status) {
            case 'diagnostic': return 'status-pending';
            case 'repair':
            case 'painting': return 'status-in-progress';
            case 'ready': return 'status-completed';
            case 'completed': return 'status-completed';
            default: return '';
        }
    }

    function searchCars() {
        const searchText = document.getElementById('car-search').value.toLowerCase();
        const rows = document.getElementById('cars-table-body').getElementsByTagName('tr');

        for (let i = 0; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName('td');
            let found = false;

            for (let j = 0; j < cells.length - 1; j++) {
                if (cells[j].textContent.toLowerCase().includes(searchText)) {
                    found = true;
                    break;
                }
            }

            rows[i].style.display = found ? '' : 'none';
        }
    }

    function searchClients() {
        const searchText = document.getElementById('client-search').value.toLowerCase();
        const rows = document.getElementById('clients-table-body').getElementsByTagName('tr');

        for (let i = 0; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName('td');
            let found = false;

            for (let j = 0; j < cells.length - 1; j++) {
                if (cells[j].textContent.toLowerCase().includes(searchText)) {
                    found = true;
                    break;
                }
            }

            rows[i].style.display = found ? '' : 'none';
        }
    }

    function editClient(clientId) {
        alert('Редактирование клиента будет реализовано в следующей версии');
    }

    function viewClient(clientId) {
        const client = clientsDatabase.find(c => c.id === clientId);
        if (!client) return;

        const clientCars = carsDatabase.filter(car => car.clientId === client.id);

        let carList = 'Нет автомобилей';
        if (clientCars.length > 0) {
            carList = clientCars.map(car =>
                `${car.brand} ${car.model} (${car.number}) - ${getStatusText(car.status)}`
            ).join('\n');
        }

        alert(`Информация о клиенте:\n\nИмя: ${client.name}\nТелефон: ${client.phone}\nEmail: ${client.email}\n\nАвтомобили:\n${carList}`);
    }

    function changePassword() {
        alert('Смена пароля будет реализована в следующей версии');
    }

    function systemSettings() {
        alert('Настройки системы будут реализованы в следующей версии');
    }

    function logout() {
        document.getElementById('auth-view').style.display = 'flex';
        document.getElementById('auth-view').style.opacity = '1';
        document.getElementById('app').classList.remove('show');
        document.getElementById('adminSection').style.display = 'none';
        document.getElementById('user-tabbar').style.display = 'none';
        document.getElementById('admin-tabbar').style.display = 'none';
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
    }

    // Initialize app when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
        App.init();
        document.getElementById('adminSection').style.display = 'none';
        document.getElementById('user-tabbar').style.display = 'none';
        document.getElementById('admin-tabbar').style.display = 'none';
    });
</script>
</body>
</html>
